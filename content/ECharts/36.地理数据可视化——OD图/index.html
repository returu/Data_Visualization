<!DOCTYPE html>
<html style="height:100%">

<head>
    <meta charset="utf-8">
    <!-- 引入下载的 echarts.js 文件 -->
    <script type="text/javascript" src="js/echarts.js"></script>
    <!-- 引入下载的 query.min.js 文件 -->
    <script type="text/javascript" src="js/jquery.min.js"></script>
    <!-- 引入下载的 bmap.js 文件 -->
    <script type="text/javascript" src="js/bmap.js"></script>
    <!-- 引入百度地图开放平台接口服务 -->
    <script src="https://api.map.baidu.com/getscript?v=3.0&ak=KOmVjPVUAey1G2E8zNhPiuQ6QiEmAwZu&services=&t=20230614151358"></script>
    <title>ECharts图表</title>
</head>

<body style="height: 100%; margin: 0">
    <!-- 为 ECharts 准备一个定义了宽高的 DOM -->
    <div id="container" style="height:100%"></div>
    <script type="text/javascript">
    // 基于准备好的dom，初始化echarts实例
    var myChart = echarts.init(document.getElementById('container'));

    $.getJSON('data.json', function(data) {
        $.getJSON('city_points.json', function(city_points) {
            $.getJSON('styleJson.json', function(styleJson) {

                // 设置图表的参数
                var option = {
                    // bmap组件
                    bmap: {
                        center: [108.9010, 34.4294], // 地图中心点坐标
                        zoom: 6, // 地图层级
                        roam: true, // 可以对地图进行缩放
                        // 地图底图样式设置
                        mapStyle: {
                            styleJson: styleJson
                        }
                    },

                    title: {
                        text: "北京迁入人口来源地",
                        textStyle: { color: "#fff", fontSize: 30 },
                        subtext: "数据来源：纯属虚构",
                        subtextStyle: { color: "#fff" },
                        left: "center"
                    },

                    // 视觉映射组件
                    visualMap: {
                        max: 100,
                        inRange: {
                            color: ['green', '#eac736', '#d94e5d'],
                            colorAlpha: [0, 1]
                        },
                    },

                    // 数据系列
                    series: [{
                        type: 'lines', // lines 类型图表
                        coordinateSystem: 'bmap', // 该系列使用的坐标系
                        data: data,
                        // 线样式
                        lineStyle: {
                            normal: {
                                // color: '#fff', // #a6c84c
                                width: 0.8, // 线宽
                                curveness: 0.1 // 边的曲度，支持从 0 到 1 的值，值越大曲度越大
                            }
                        },
                        // 线特效的配置
                        effect: {
                            show: true, // 是否显示特效
                            period: 10, // 特效动画的时间，单位为 s
                            constantSpeed: 100, // 配置特效图形的移动动画是否是固定速度，单位像素/秒
                            trailLength: 0.7, // 特效尾迹的长度。取从 0 到 1 的值，数值越大尾迹越长
                            symbolSize: 3 // 特效标记的大小
                        },
                    },{
                        type: 'effectScatter',
                        coordinateSystem: 'bmap', // 带有涟漪特效动画的散点（气泡）图
                        // 图形上的文本标签
                        label: {
                            // 
                            emphasis: {
                                show: true,
                                position: 'right', // 标签的位置
                                fontSize: 15,
                                // 标签内容格式器
                                // 通过回调函数设置显示内容：城市名称+迁徙量
                                formatter: function(params) { return params['name'] + ' - ' + params['value'][2] }
                            }
                        },
                        data: city_points,
                        // 通过回调函数设置标记的大小
                        // params[2]为每个OD的迁徙量
                        symbolSize: function(params) { return params[2] ** 0.5 *2 }
                    }
                    ],
                };


                // 使用指定的配置项和数据显示图表
                myChart.setOption(option);
            })
        })
    })
    </script>
</body>

</html>
<!DOCTYPE html>
<html style="height:100%">

<head>
    <meta charset="utf-8">
    <!-- 引入下载的 echarts.js 文件 -->
    <script type="text/javascript" src="js/echarts.js"></script>
    <!-- 引入下载的 query.min.js 文件 -->
    <script type="text/javascript" src="js/jquery.min.js"></script>
    <!-- 引入下载的 bmap.js 文件 -->
    <script type="text/javascript" src="js/bmap.js"></script>
    <!-- 引入百度地图开放平台接口服务 -->
    <script src="https://api.map.baidu.com/getscript?v=3.0&ak=KOmVjPVUAey1G2E8zNhPiuQ6QiEmAwZu&services=&t=20230614151358"></script>
    <title>ECharts图表</title>
</head>

<body style="height: 100%; margin: 0">
    <!-- 为 ECharts 准备一个定义了宽高的 DOM -->
    <div id="container" style="height:100%"></div>
    <script type="text/javascript">
    // 基于准备好的dom，初始化echarts实例
    var myChart = echarts.init(document.getElementById('container'));

    $.getJSON('data.json', function(data) {
        $.getJSON('styleJson.json', function(styleJson) {

            var hStep = 300 / (data.length - 1);
            var busLines = [];
            // 通过for循环为每条线路添加lineStyle属性
            for (var i =0 ; i < data.length ; i++){
                busLines.push({
                    coords:data[i]['coords'],
                    // 为每条线设置不同的颜色
                    lineStyle:{
                        normal:{
                            color:echarts.color.modifyHSL('#5A94DF', Math.round(hStep * i))
                        }
                    }
                })
            }

            // 设置图表的参数
            var option = {
                // bmap组件
                bmap: {
                    center: [116.46, 39.92], // 地图中心点坐标
                    zoom: 10, // 地图层级
                    roam: true, // 可以对地图进行缩放
                    // 地图底图样式设置
                    mapStyle: {
                        styleJson: styleJson
                    }
                },

                title: {
                    text: "北京公交线路图",
                    textStyle:{color:"#fff",fontSize:20},
                    subtext: "数据来源：ECharts官方示例",
                    subtextStyle:{color:"#fff"},
                    left: "center"
                },

                // 数据系列
                series: [{
                    type: 'lines', // lines 类型图表
                    coordinateSystem: 'bmap', // 该系列使用的坐标系
                    polyline: true, // 绘制多段线
                    data: busLines,
                    silent: true, // 图形是否不响应和触发鼠标事件，默认为 false，即响应和触发鼠标事件
                    lineStyle: {
                        opacity: 0.2, // 图形透明度
                        width: 1 // 线宽
                    },
                    progressiveThreshold: 500, // 渐进式渲染时每一帧绘制图形数量，设为 0 时不启用渐进式渲染
                    progressive: 200 // 启用渐进式渲染的图形数量阈值，在单个系列的图形数量超过该阈值时启用渐进式渲染
                }, {
                    type: 'lines',
                    coordinateSystem: 'bmap',
                    polyline: true,
                    data: busLines,
                    lineStyle: {
                        width: 0
                    },
                    // 线特效的配置
                    effect: {
                        constantSpeed: 20, // 配置特效图形的移动动画是否是固定速度，单位像素/秒
                        show: true, // 显示特效
                        trailLength: 0.1, // 特效尾迹的长度
                        symbolSize: 1.5 // 特效标记的大小
                    },
                    zlevel: 1 // zlevel 大的 Canvas 会放在 zlevel 小的 Canvas 的上面,默认为0
                }],
            };


            // 使用指定的配置项和数据显示图表
            myChart.setOption(option);
        })
    })
    </script>
</body>

</html>